[platformio]
default_envs = esp32s3_no_psram

[env]
platform = espressif32
board = um_pros3
framework = arduino
monitor_speed = 115200
build_type = release
board_build.flash_size = 16MB
board_upload.flash_size = 16MB
board_upload.maximum_size = 16777216
board_upload.before = default_reset
board_upload.after = hard_reset
board_upload.flash_mode = keep
board_upload.flash_freq = 40m
board_build.partitions = partitions/growsensor_16mb.csv
upload_protocol = esptool
build_unflags =
    -Os
build_flags =
    -DARDUINO_ARCH_ESP32
    -DARDUINO_ARCH_ESP32S3
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DENABLE_MDNS=1
    -O2
    -ffunction-sections
    -fdata-sections
    -Wl,--gc-sections
    -DGS_FIRMWARE_VERSION=\"v1.1.0-s3\"
    -DGS_FIRMWARE_CHANNEL=\"stable\"
    -Isrc
extra_scripts =
    pre:scripts/partition_guard.py
lib_deps =
    claws/BH1750@^1.2.0
    adafruit/Adafruit SHT31 Library@^2.2.0
    adafruit/Adafruit MLX90614 Library@^2.1.3
    wifwaf/MH-Z19@^1.5.4
    bblanchon/ArduinoJson@^6.21.2

[env:esp32s3_no_psram]
board_build.esp32_psram = disabled
board_build.psram = disabled
build_flags =
    ${env.build_flags}
    -DGS_TARGET_BOARD=\"ESP32-S3-16MB (no PSRAM)\"

[env:esp32s3_psram_opi]
board_build.esp32_psram = enabled
board_build.psram = enabled
board_build.arduino.memory_type = qio_opi
build_flags =
    ${env.build_flags}
    -DBOARD_HAS_PSRAM
    -DCONFIG_SPIRAM_SUPPORT=1
    -mfix-esp32-psram-cache-issue
    -DGS_TARGET_BOARD=\"ESP32-S3-16MB (PSRAM OPI)\"

[env:esp32s3_psram_qspi]
board_build.esp32_psram = enabled
board_build.psram = enabled
board_build.arduino.memory_type = qio_qspi
build_flags =
    ${env.build_flags}
    -DBOARD_HAS_PSRAM
    -DCONFIG_SPIRAM_SUPPORT=1
    -mfix-esp32-psram-cache-issue
    -DGS_TARGET_BOARD=\"ESP32-S3-16MB (PSRAM QSPI)\"
